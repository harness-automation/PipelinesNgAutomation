apiVersion: v1
kind: Template
metadata:
  name: sample-manifests
  annotations:
    description: "Sample manifests description"
    iconClass: "sample-manifests"
    tags: "database,nosql"
objects:
- apiVersion: v1
  kind: Secret
  metadata:
    annotations:
      harness.io/skip-versioning: 'true'
    name: {{.Values.name}}-dockercfg
  type: kubernetes.io/dockercfg
  data:
    .dockercfg: ${DOCKER_CFG}
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: {{.Values.name}}
  data:
    key1: value1
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: {{.Values.name}}-cm
  data:
    hello: world
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: {{.Values.name}}-deployment
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: {{.Values.name}}
    template:
      metadata:
        labels:
          app: {{.Values.name}}
      spec:
        imagePullSecrets:
        - name: {{.Values.name}}-dockercfg
        containers:
        - name: {{.Values.name}}
          image: ${IMAGE}
          envFrom:
          - configMapRef:
              name: {{.Values.name}}
- apiVersion: v1  
  kind: Service
  metadata:
    name: {{.Values.name}}-svc
  spec:
    type: LoadBalancer
    ports:
    - port: 80
      targetPort: 80
      protocol: TCP
    selector:
      app: {{.Values.name}}
parameters:
- name: IMAGE
  value: nginx:latest
- name: DOCKER_CFG
  value: eyJodHRwczovL2luZGV4LmRvY2tlci5pby92Mi8iOnsidXNlcm5hbWUiOiJkb2NrZXJjaXJlYWQiLCJwYXNzd29yZCI6IkQwY2tlckhAcm5lJCRDaVJlYWQhIn19
